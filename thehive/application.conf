# TheHive 5 - Application Configuration
# SOC Platform Integration

# =============================================================
# Database (PostgreSQL)
# =============================================================
db {
  provider = "postgres"
  postgres {
    host    = "postgres"
    port    = "5432"
    database = "thehive"
    user    = "thehive"
    password = ${?POSTGRES_PASSWORD}
  }
}

# =============================================================
# Index (Elasticsearch / OpenSearch)
# =============================================================
index {
  search {
    provider = "no-op"
  }
}

# =============================================================
# Storage
# =============================================================
storage {
  provider = local
  localFs {
    location = /opt/thp/thehive/data
  }
}

# =============================================================
# Authentication
# =============================================================
auth {
  providers = [
    {name = session, duration = "12 hours"},
    {name = basic, realm = thehive},
    {name = header, userHeader = "X-Remote-User"}
  ]
}

# =============================================================
# Secret Key
# =============================================================
play.http.secret.key = ${?THEHIVE_SECRET}

# =============================================================
# Cortex Integration
# =============================================================
cortex {
  servers = [
    {
      name          = "cortex-1"
      url           = "http://cortex:9001"
      auth {
        type = "bearer"
        key  = ${?CORTEX_API_KEY}
      }
      ws {
        ssl {
          loose {
            acceptAnyCertificate = true
          }
        }
      }
    }
  ]
  refreshDelay  = 5 seconds
  maxRetryOnError = 3
  statusCheckInterval = 1 minute
}

# =============================================================
# MISP Integration
# =============================================================
misp {
  servers = [
    {
      name  = "misp-soc"
      url   = "http://misp:80"
      auth {
        type = "key"
        key  = ${?MISP_AUTH_KEY}
      }
    }
  ]
  interval        = 1 hour
  maxAge          = 2 days
  importedCaseTags = [ "misp:event" ]
  exportCaseTags   = [ "misp:export" ]
}

# =============================================================
# Notifications (Shuffle)
# =============================================================
notification.triggers = [
  { name = "CaseCreated" }
  { name = "AlertImported" }
]
