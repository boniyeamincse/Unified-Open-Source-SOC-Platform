<!-- ==================================================================
  Unified Open-Source SOC Platform
  Author : Boni Yeamin
  Open Source V:1.0
  File   : wazuh/ossec.conf
  Purpose: Wazuh Manager main configuration â€” controls log analysis,
           FIM, vulnerability detection, rootcheck, active response,
           and Suricata EVE JSON log ingestion.
================================================================== -->

<ossec_config>

  <!-- ============================================================ -->
  <!-- GLOBAL SETTINGS                                              -->
  <!-- ============================================================ -->
  <global>
    <jsonout_output>yes</jsonout_output>
    <alerts_log>yes</alerts_log>
    <logall>no</logall>
    <logall_json>no</logall_json>
    <email_notification>no</email_notification>
    <max_output_size>0</max_output_size>
  </global>

  <!-- ============================================================ -->
  <!-- ALERTS                                                       -->
  <!-- ============================================================ -->
  <alerts>
    <log_alert_level>3</log_alert_level>
    <email_alert_level>12</email_alert_level>
  </alerts>

  <!-- ============================================================ -->
  <!-- LOGGING                                                      -->
  <!-- ============================================================ -->
  <logging>
    <log_format>plain</log_format>
  </logging>

  <!-- ============================================================ -->
  <!-- REMOTE (Agent Communication)                                 -->
  <!-- ============================================================ -->
  <remote>
    <connection>secure</connection>
    <port>1514</port>
    <protocol>tcp</protocol>
    <queue_size>131072</queue_size>
  </remote>

  <!-- ============================================================ -->
  <!-- ROOTCHECK                                                    -->
  <!-- ============================================================ -->
  <rootcheck>
    <disabled>no</disabled>
    <check_files>yes</check_files>
    <check_trojans>yes</check_trojans>
    <check_dev>yes</check_dev>
    <check_sys>yes</check_sys>
    <check_pids>yes</check_pids>
    <check_ports>yes</check_ports>
    <check_if>yes</check_if>
    <frequency>43200</frequency>
    <rootkit_files>/var/ossec/etc/shared/rootkit_files.txt</rootkit_files>
    <rootkit_trojans>/var/ossec/etc/shared/rootkit_trojans.txt</rootkit_trojans>
  </rootcheck>

  <!-- ============================================================ -->
  <!-- FILE INTEGRITY MONITORING (FIM)                              -->
  <!-- ============================================================ -->
  <syscheck>
    <disabled>no</disabled>
    <frequency>43200</frequency>
    <scan_on_start>yes</scan_on_start>
    <!-- Critical system paths -->
    <directories check_all="yes">/etc,/usr/bin,/usr/sbin</directories>
    <directories check_all="yes">/bin,/sbin,/boot</directories>
    <!-- Ignore volatile paths -->
    <ignore>/etc/mtab</ignore>
    <ignore>/etc/hosts.deny</ignore>
    <ignore>/etc/mail/statistics</ignore>
    <ignore>/etc/random-seed</ignore>
    <ignore>/etc/adjtime</ignore>
    <ignore>/etc/httpd/logs</ignore>
    <nodiff>/etc/ssl/private.key</nodiff>
  </syscheck>

  <!-- ============================================================ -->
  <!-- VULNERABILITY DETECTION                                      -->
  <!-- ============================================================ -->
  <vulnerability-detector>
    <enabled>yes</enabled>
    <interval>12h</interval>
    <min_full_scan_interval>6h</min_full_scan_interval>
    <run_on_start>yes</run_on_start>

    <provider name="canonical">
      <enabled>yes</enabled>
      <os>focal</os>
      <os>jammy</os>
      <update_interval>1h</update_interval>
    </provider>

    <provider name="debian">
      <enabled>yes</enabled>
      <os>buster</os>
      <os>bullseye</os>
      <os>bookworm</os>
      <update_interval>1h</update_interval>
    </provider>

    <provider name="nvd">
      <enabled>yes</enabled>
      <update_interval>1h</update_interval>
    </provider>
  </vulnerability-detector>

  <!-- ============================================================ -->
  <!-- LOG ANALYSIS                                                 -->
  <!-- ============================================================ -->
  <localfile>
    <log_format>syslog</log_format>
    <location>/var/log/syslog</location>
  </localfile>

  <localfile>
    <log_format>syslog</log_format>
    <location>/var/log/auth.log</location>
  </localfile>

  <localfile>
    <log_format>apache</log_format>
    <location>/var/log/nginx/access.log</location>
  </localfile>

  <!-- Suricata EVE JSON Integration -->
  <localfile>
    <log_format>json</log_format>
    <location>/var/log/suricata/eve.json</location>
    <label key="agent.type">suricata</label>
  </localfile>

  <!-- ============================================================ -->
  <!-- ACTIVE RESPONSE                                              -->
  <!-- ============================================================ -->
  <active-response>
    <disabled>no</disabled>
    <ca_store>/var/ossec/etc/wpk_root.pem</ca_store>
    <ca_verification>yes</ca_verification>
  </active-response>

  <!-- Auto-block brute force sources (correlation rule 100001) -->
  <active-response>
    <command>firewall-drop</command>
    <location>local</location>
    <rules_id>100001,100003,100004</rules_id>
    <timeout>3600</timeout>
  </active-response>

  <!-- Auto-isolate on lateral movement or ransomware (P1 alerts) -->
  <active-response>
    <command>host-deny</command>
    <location>local</location>
    <rules_id>100020,100030,100031</rules_id>
    <timeout>86400</timeout>
  </active-response>

  <!-- ============================================================ -->
  <!-- CUSTOM CORRELATION RULES (Phase 3)                           -->
  <!-- ============================================================ -->
  <ruleset>
    <include>rules/soc-correlation.xml</include>
  </ruleset>

</ossec_config>
